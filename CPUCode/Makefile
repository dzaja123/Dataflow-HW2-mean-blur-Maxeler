# Generated by "$MAXCOMPILERDIR/lib/MaxIDE/projectAdmin.jar" (05-Nov-2015 14:09:19).

ifndef RUNRULE
  $(error The RUNRULE environment variable is not set. Usage: 'make RUNRULE="<RunRule>"')
endif

RUNRULE_DIR = ../RunRules/$(RUNRULE)
CPU_DIR = ../CPUCode/
include $(RUNRULE_DIR)/Makefile.settings

all: build

MAXFILES     = $(patsubst %.max,$(RUNRULE_DIR)/maxfiles/%.max, $(RUNRULE_MAXFILES))
MAXFILES_H   = $(patsubst %.h,$(RUNRULE_DIR)/include/%.h, $(RUNRULE_MAXFILES_H))

build: $(MAXFILES) $(MAXFILES_H)
	$(MAKE) -f Makefile.rules build

run: build
	$(MAKE) -f Makefile.rules run
	@echo "Converting .ppm to .png..."
	for f in $(CPU_DIR)/*.ppm; do \
		convert "$$f" "$${f%.ppm}.png"; \
	done
	@echo Done

clean distclean:
	$(MAKE) -f Makefile.rules $@
	$(MAKE) -C $(RUNRULE_DIR) $@

startsim stopsim help:
	$(MAKE) -f Makefile.rules $@

$(RUNRULE_DIR)/Makefile.settings:
	$(MAKE) -C $(RUNRULE_DIR) Makefile.settings

$(RUNRULE_DIR)/maxfiles/%.max:
	$(MAKE) -C $(RUNRULE_DIR) maxfiles/$*.max

$(RUNRULE_DIR)/include/%.h:
	$(MAKE) -C $(RUNRULE_DIR) include/$*.h

runsim: build
	$(MAKE) startsim
	$(MAKE) run || { $(MAKE) stopsim; exit -1; }
	$(MAKE) stopsim


.PRECIOUS: $(MAXFILES)

.PHONY: build run runsim startsim stopsim clean distclean

